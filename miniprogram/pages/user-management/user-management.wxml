<view class="container">
  <!-- æœç´¢å’Œç­›é€‰æ  -->
  <view class="search-filter-bar">
    <view class="search-box">
      <text class="search-icon">ğŸ”</text>
      <input 
        class="search-input" 
        placeholder="æœç´¢æ˜µç§°/æ‰‹æœºå·" 
        value="{{keyword}}"
        bindinput="onSearchInput"
        confirm-type="search"
        bindconfirm="onSearch"
      />
      <view class="clear-icon" wx:if="{{keyword}}" bindtap="clearSearch">âœ•</view>
    </view>
    
    <view class="filter-tabs">
      <view 
        class="filter-tab {{currentRole === '' ? 'active' : ''}}" 
        bindtap="switchRole" 
        data-role=""
      >å…¨éƒ¨</view>
      <view 
        class="filter-tab {{currentRole === 'admin' ? 'active' : ''}}" 
        bindtap="switchRole" 
        data-role="admin"
      >ç®¡ç†å‘˜</view>
      <view 
        class="filter-tab {{currentRole === 'user' ? 'active' : ''}}" 
        bindtap="switchRole" 
        data-role="user"
      >æ™®é€šç”¨æˆ·</view>
    </view>
  </view>

  <!-- ç”¨æˆ·åˆ—è¡¨ -->
  <scroll-view 
    class="user-list" 
    scroll-y 
    enable-back-to-top 
    bindscrolltolower="loadMore"
    refresher-enabled
    refresher-triggered="{{isRefreshing}}"
    bindrefresherrefresh="onRefresh"
  >
    <block wx:if="{{userList.length > 0}}">
      <view class="user-card" wx:for="{{userList}}" wx:key="_id">
        <view class="user-info-main">
          <image 
            class="user-avatar" 
            src="{{item.avatarUrl || '/images/user-avatar.png'}}" 
            mode="aspectFill"
            binderror="onAvatarError"
            data-index="{{index}}"
          ></image>
          <view class="user-details">
            <view class="user-name-row">
              <text class="user-nickname">{{item.wechatInfo.nickName || 'æœªå‘½åç”¨æˆ·'}}</text>
              <view class="role-tag {{item.isAdmin ? 'admin' : 'user'}}">
                {{item.isAdmin ? 'ç®¡ç†å‘˜' : 'æ™®é€šç”¨æˆ·'}}
              </view>
            </view>
            <view class="user-meta">
              <text class="meta-item" wx:if="{{item.userName}}">å§“å: {{item.userName}}</text>
              <text class="meta-item" wx:if="{{item.phoneNumber}}">æ‰‹æœº: {{item.phoneNumber}}</text>
            </view>
            <view class="user-time">æ³¨å†Œæ—¶é—´: {{item.createTimeStr}}</view>
          </view>
        </view>
        
        <!-- æ“ä½œæ  -->
        <view class="action-bar">
          <button 
            class="action-btn {{item.isAdmin ? 'demote' : 'promote'}}" 
            hover-class="btn-hover"
            bindtap="toggleRole" 
            data-id="{{item._id}}"
            data-is-admin="{{item.isAdmin}}"
          >
            {{item.isAdmin ? 'é™çº§ä¸ºç”¨æˆ·' : 'è®¾ä¸ºç®¡ç†å‘˜'}}
          </button>
        </view>
      </view>
      
      <!-- åŠ è½½çŠ¶æ€ -->
      <view class="loading-state" wx:if="{{isLoadingMore}}">
        <text>æ­£åœ¨åŠ è½½æ›´å¤š...</text>
      </view>
      <view class="no-more-state" wx:if="{{!hasMore && userList.length > 0}}">
        <text>æ²¡æœ‰æ›´å¤šç”¨æˆ·äº†</text>
      </view>
    </block>
    
    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{!isLoading && userList.length === 0}}">
      <image class="empty-icon" src="https://cloud1-8gaa4jfy4b22cd28-1381889662.tcloudbaseapp.com/images/empty.png" mode="aspectFit"></image>
      <text>æš‚æ— ç¬¦åˆæ¡ä»¶çš„ç”¨æˆ·</text>
    </view>
  </scroll-view>
</view>