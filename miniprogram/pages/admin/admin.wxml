<!--pages/admin/admin.wxml-->
<view class="modern-container">
  <!-- é¡¶éƒ¨èƒŒæ™¯ -->
  <view class="bg-decoration"></view>

  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <text class="page-title">é£æœºç®¡ç†åå°</text>
    <text class="page-subtitle">é«˜æ•ˆç®¡ç†æœºé˜Ÿèµ„äº§ä¸ä¿¡æ¯</text>
  </view>

  <!-- ç»Ÿè®¡æ¦‚è§ˆå¡ç‰‡ -->
  <view class="stats-grid">
    <view class="stat-card">
      <view class="stat-value">{{aircraftList.length || 0}}</view>
      <view class="stat-label">æœºé˜Ÿæ€»æ•°</view>
    </view>
    <view class="stat-card">
      <view class="stat-value highlight">{{boundCount || 0}}</view>
      <view class="stat-label">å·²ç»‘å®š</view>
    </view>
  </view>

  <!-- æ·»åŠ é£æœºè¡¨å• -->
  <view class="section-title-bar" id="add-form">
    <text class="section-name">å½•å…¥æ–°æœº</text>
  </view>

  <view class="card form-card">
    <view class="form-grid">
      <!-- åºåˆ—å· -->
      <view class="form-item">
        <text class="label">åºåˆ—å· <text class="required">*</text></text>
        <view class="input-box">
          <input 
            class="input" 
            placeholder="è¯·è¾“å…¥åºåˆ—å·" 
            placeholder-class="placeholder"
            value="{{aircraftData.serialNumber}}" 
            bindinput="onAircraftInput" 
            data-field="serialNumber" 
          />
        </view>
      </view>
      
      <!-- æ³¨å†Œå· -->
      <view class="form-item">
        <text class="label">æ³¨å†Œå·</text>
        <view class="input-box">
          <input 
            class="input" 
            placeholder="è¯·è¾“å…¥æ³¨å†Œå·" 
            placeholder-class="placeholder"
            value="{{aircraftData.registrationNumber}}" 
            bindinput="onAircraftInput" 
            data-field="registrationNumber" 
          />
        </view>
      </view>
      
      <!-- ç”Ÿäº§å¹´ä»½ -->
      <view class="form-item">
        <text class="label">ç”Ÿäº§å¹´ä»½ <text class="required">*</text></text>
        <view class="input-box">
          <input 
            class="input" 
            type="number" 
            placeholder="ä¾‹å¦‚: 2025" 
            placeholder-class="placeholder"
            value="{{aircraftData.yearOfManufacture}}" 
            bindinput="onAircraftInput" 
            data-field="yearOfManufacture" 
          />
        </view>
      </view>
    </view>

    <!-- å›¾ç‰‡ä¸Šä¼  -->
    <view class="upload-area">
      <text class="label">é£æœºç…§ç‰‡</text>
      <view class="upload-box" bindtap="chooseAircraftImage">
        <image wx:if="{{aircraftImageSrc}}" src="{{aircraftImageSrc}}" class="preview-img" mode="aspectFill"></image>
        <view wx:else class="upload-placeholder">
          <view class="upload-icon-circle">
            <text class="icon">ğŸ“·</text>
          </view>
          <text class="upload-text">ç‚¹å‡»ä¸Šä¼ ç…§ç‰‡</text>
        </view>
      </view>
    </view>
    
    <button 
      class="submit-btn {{(!canSubmit || submitting) ? 'disabled' : ''}}" 
      bindtap="addAircraft" 
      disabled="{{!canSubmit || submitting}}"
      hover-class="btn-hover"
    >
      {{submitting ? 'æ­£åœ¨æäº¤...' : 'ç¡®è®¤æ·»åŠ '}}
    </button>
  </view>
  
  <!-- é£æœºåˆ—è¡¨ -->
  <view class="section-title-bar list-header">
    <text class="section-name">æœºé˜Ÿåˆ—è¡¨</text>
    <view class="list-filter">
      <text>å…± {{aircraftList.length}} æ¶</text>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{aircraftList.length === 0}}">
    <image class="empty-image" src="/images/aircraft-placeholder.png" mode="aspectFit"></image>
    <text class="empty-text">æš‚æ— é£æœºæ•°æ®</text>
    <text class="empty-sub">å¿«å»ä¸Šæ–¹å½•å…¥ç¬¬ä¸€æ¶é£æœºå§</text>
  </view>

  <!-- åˆ—è¡¨å¡ç‰‡ -->
  <view class="aircraft-list" wx:else>
    <view class="aircraft-card" wx:for="{{aircraftList}}" wx:key="_id">
      <view class="card-status {{item.isBound ? 'bound' : 'unbound'}}">
        {{item.isBound ? 'å·²ç»‘å®š' : 'æœªç»‘å®š'}}
      </view>
      
      <view class="card-main">
        <image class="card-thumb" src="{{item.image || '/images/aircraft-placeholder.png'}}" mode="aspectFill"></image>
        <view class="card-info">
          <view class="card-header">
            <text class="card-serial">{{item.serialNumber}}</text>
            <text class="card-reg">{{item.registrationNumber ? 'æ³¨å†Œå· ' + item.registrationNumber : 'æœªæ³¨å†Œ'}}</text>
          </view>
          <view class="card-meta">
            <text class="meta-item">ğŸ“… {{item.yearOfManufacture}}å¹´</text>
            <text class="meta-item">â±ï¸ {{item.totalHours || 0}}å°æ—¶</text>
          </view>
        </view>
      </view>
      
      <view class="card-actions">
        <view class="action-btn edit" catchtap="editAircraft" data-id="{{item._id}}" data-index="{{index}}" hover-class="action-hover">
          <text class="action-icon">âœï¸</text>
          <text>ç¼–è¾‘</text>
        </view>
        <view class="action-divider"></view>
        <view class="action-btn delete" catchtap="deleteAircraft" data-id="{{item._id}}" data-index="{{index}}" hover-class="action-hover">
          <text class="action-icon">ğŸ—‘ï¸</text>
          <text>åˆ é™¤</text>
        </view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨ç•™ç™½ -->
  <view class="footer-spacer"></view>
</view>

<!-- å›¾ç‰‡å‹ç¼©ç”»å¸ƒ -->
<canvas type="2d" id="compressCanvas" style="position: absolute; top: -9999px; left: -9999px; width: 1920px; height: 1920px;"></canvas>

<!-- ç¼–è¾‘å¼¹çª— -->
<view class="modal-mask {{showEditModal ? 'show' : ''}}" bindtap="closeEditModal">
  <view class="modal-container" catchtap="preventProp">
    <view class="modal-header">
      <text class="modal-title">ç¼–è¾‘ä¿¡æ¯</text>
      <view class="modal-close" bindtap="closeEditModal">Ã—</view>
    </view>
    
    <scroll-view scroll-y class="modal-content">
      <view class="form-item">
        <text class="label">åºåˆ—å·</text>
        <view class="input-box">
          <input class="input" value="{{editAircraftData.serialNumber}}" bindinput="onEditInput" data-field="serialNumber" />
        </view>
      </view>
      
      <view class="form-item">
        <text class="label">æ³¨å†Œå·</text>
        <view class="input-box">
          <input class="input" value="{{editAircraftData.registrationNumber}}" bindinput="onEditInput" data-field="registrationNumber" />
        </view>
      </view>
      
      <view class="form-item">
        <text class="label">ç”Ÿäº§å¹´ä»½</text>
        <view class="input-box">
          <input class="input" type="number" value="{{editAircraftData.yearOfManufacture}}" bindinput="onEditInput" data-field="yearOfManufacture" />
        </view>
      </view>
      
      <view class="upload-area mini">
        <text class="label">æ›´æ–°ç…§ç‰‡</text>
        <view class="upload-box" bindtap="chooseEditImage">
          <image wx:if="{{editImageSrc}}" src="{{editImageSrc}}" class="preview-img" mode="aspectFill"></image>
          <view wx:else class="upload-placeholder">
            <text class="icon">ğŸ“·</text>
            <text class="upload-text">æ›´æ¢ç…§ç‰‡</text>
          </view>
        </view>
      </view>
    </scroll-view>
    
    <view class="modal-footer">
      <button class="modal-btn cancel" bindtap="closeEditModal">å–æ¶ˆ</button>
      <button class="modal-btn confirm {{editSubmitting ? 'disabled' : ''}}" bindtap="confirmEdit" disabled="{{!canEditSubmit || editSubmitting}}">
        {{editSubmitting ? 'ä¿å­˜ä¸­...' : 'ä¿å­˜ä¿®æ”¹'}}
      </button>
    </view>
  </view>
</view>