<!--pages/edit-profile/edit-profile.wxml-->
<view class="edit-profile-container">
  <view class="content-wrapper">
    <!-- å¤´åƒç¼–è¾‘ -->
    <view class="card avatar-card">
      <view class="avatar-wrapper">
        <view class="avatar-rigid-wrapper">
          <button class="avatar-btn" open-type="chooseAvatar" bindchooseavatar="onChooseAvatar">
            <image src="{{userInfo.avatar}}" mode="aspectFill" class="avatar-img"></image>
            <view class="camera-badge">
              <text>ğŸ“·</text>
            </view>
          </button>
        </view>
        <text class="avatar-tip">ç‚¹å‡»æ›´æ¢å¤´åƒ</text>
      </view>
    </view>

    <!-- å¾®ä¿¡ä¿¡æ¯å¿«æ·è·å– -->
    <view class="card wechat-card" wx:if="{{!userInfo.avatar || !userInfo.nickName}}">
      <view class="wechat-tip-row">
        <text class="tip-text">åŒæ­¥å¾®ä¿¡å¤´åƒå’Œæ˜µç§°</text>
        <button class="sync-btn" bindtap="getUserProfile">ä¸€é”®åŒæ­¥</button>
      </view>
    </view>

    <!-- åŸºæœ¬ä¿¡æ¯è¡¨å• -->
    <view class="card form-card">
      <view class="card-title">åŸºæœ¬ä¿¡æ¯</view>
      
      <!-- æ˜µç§° -->
      <view class="form-item">
        <text class="label">æ˜µç§°</text>
        <view class="input-wrapper {{validationErrors.nickName ? 'error' : ''}}">
          <input 
            type="nickname"
            class="input"
            placeholder="è¯·è¾“å…¥æ˜µç§°" 
            placeholder-class="placeholder"
            value="{{userInfo.nickName}}" 
            bindinput="onNicknameInput"
            bindchange="onNicknameInput"
            bindfocus="onFieldFocus"
            bindblur="onFieldBlur"
            maxlength="20"
          />
          <text class="counter">{{userInfo.nickName.length}}/20</text>
        </view>
        <view class="error-msg" wx:if="{{validationErrors.nickName}}">{{validationErrors.nickName}}</view>
      </view>
      
      <!-- å…¬å¸åç§° -->
      <view class="form-item">
        <text class="label">å…¬å¸åç§°</text>
        <view class="input-wrapper {{validationErrors.companyName ? 'error' : ''}}">
          <input 
            class="input"
            placeholder="è¯·è¾“å…¥å…¬å¸åç§°" 
            placeholder-class="placeholder"
            value="{{userInfo.companyName}}" 
            bindinput="onCompanyNameInput"
            bindfocus="onFieldFocus"
            bindblur="onFieldBlur"
            maxlength="30"
          />
          <text class="counter">{{userInfo.companyName.length}}/30</text>
        </view>
        <view class="error-msg" wx:if="{{validationErrors.companyName}}">{{validationErrors.companyName}}</view>
      </view>

      <!-- æ‰‹æœºå·ç  -->
      <view class="form-item">
        <text class="label">æ‰‹æœºå·ç </text>
        <view class="phone-wrapper">
          <block wx:if="{{userInfo.phoneNumber}}">
            <text class="phone-val">{{userInfo.phoneNumber}}</text>
          </block>
          <block wx:else>
             <button wx:if="{{showPhoneAuthButton}}" class="get-phone-btn" open-type="getPhoneNumber" bindgetphonenumber="getPhoneNumber">
              è·å–å·ç 
            </button>
            <text wx:else class="placeholder">æœªè·å–</text>
          </block>
        </view>
      </view>
    </view>

    <!-- è®¤è¯ä¿¡æ¯ï¼ˆåªè¯»ï¼‰ -->
    <view class="card auth-card">
      <view class="card-title">è®¤è¯çŠ¶æ€</view>
      <view class="auth-list">
        <view class="auth-row">
          <text class="auth-key">æœºä¸»è®¤è¯</text>
          <view class="auth-tag {{userInfo.hasBoundAircraft ? 'verified' : 'pending'}}">
            {{userInfo.hasBoundAircraft ? 'å·²è®¤è¯' : 'æœªè®¤è¯'}}
          </view>
        </view>
        <view class="divider"></view>
        <view class="auth-row">
          <text class="auth-key">ä¼šå‘˜ç­‰çº§</text>
          <text class="auth-val">{{userInfo.memberLevel || 'æ™®é€šä¼šå‘˜'}}</text>
        </view>
        <view class="divider"></view>
        <view class="auth-row">
          <text class="auth-key">æœåŠ¡ç­‰çº§</text>
          <text class="auth-val">{{userInfo.serviceLevel || 'æ ‡å‡†æœåŠ¡'}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="footer-action">
    <button 
      class="save-btn {{saving ? 'loading' : ''}}" 
      hover-class="btn-hover"
      bindtap="saveProfile"
      disabled="{{saving}}"
    >
      {{saving ? 'ä¿å­˜ä¸­...' : 'ä¿å­˜ä¿®æ”¹'}}
    </button>
  </view>
</view>